# batch_exec
バッチ処理を手軽に並列実行するためのプログラムを作りました。

バッチ処理を並列実行するときにどうしますか？
2並列にするときはタスクリストを2分割、3並列にするときは3分割、などとしていませんか？
途中でCPUが空いたので、「やっぱり10並列にしたい！」というときはどうしますか？
こういった問題を解決するのが添付のスクリプトです。

使い方は、並列実行したい分だけ batch_exec.pl を実行すればOKです。
例えば、マシンAで2並列、マシンBで3並列実行したいなら、マシンAで2プロセス、マシンBで3プロセス実行します。

これを実現している仕組みは簡単で、タスクリストの各タスクに対して以下を繰り返します。

1. 出力ファイルが存在していればタスクが既に終了しているので次のタスクへ

2. ロックファイルがあれば既に実行中なので次のタスクへ

3. 出力ファイルもロックファイルもなければロックファイルを作成してタスクを実行

物は試しで、
```
./batch_exec.pl task_list.txt 2
```
を何プロセスか同時に実行してみてください。
50個のタスクが重複なしで順番に実行されます。
別のターミナルで実行する方が挙動がわかりやすいです。

ただし、実際に使用する際には、&をつけて、
```
./batch_exec.pl task_list.txt 2 &
```
を1つのターミナルで何度も実行するのがお薦めです。

*****

以下、添付ファイルの説明です。

* batch_exec.pl: 並列実行するプログラム

  タスクリストのファイル名と、出力ファイルがタスクリストの何番目の引数であるか、の2つを引数にとる。
 
  例：
```
./batch_exec.pl task_list.txt 2
```
* dummy_prog.pl: 実行例を示すためのプログラム

  実行すると、2秒待った後に出力ファイルに書き込んで（作成して）終了する。2つめの引数が出力ファイル名である。

* task_list.txt: 実行例を示すためのタスクリスト

  dummy_prog.plを50回実行するようになっている。

